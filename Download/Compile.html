<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>

<HEAD>
<TITLE>Compiling GNU TeXmacs (FSF GNU project)</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFFF">

<BR><BR>

<P ALIGN=CENTER><B><FONT COLOR="#000050" SIZE=+4>
  Compilation of GNU TeXmacs
</FONT></B><BR></P>

<HR>

<BR>

<H3><b>1. Verify the TeXmacs dependencies</b></H3>

<P>
  Before you install TeXmacs on your system, you have to make
  sure that the other programs on which TeXmacs depends,
  namely TeX and Guile Scheme (from the Gnome project)
  have been installed correctly. You can do this by checking whether
  the <tt>latex</tt> and <tt>guile</tt> binaries exists in your path
  <pre>
    which latex
    which guile-config
  </pre>
  If one of these commands yields an error message,
  then <A HREF="Dependencies.html">click here</A>.
</P>

<H3><b>2. Download and unpack the source code</b></H3>
<P>

<P>
  Download the <A HREF="ftp://ftp.texmacs.org/pub/TeXmacs/targz/TeXmacs-0.3.4.10-src.tar.gz">latest version</A>
  of the source code, or the
  <A HREF="ftp://ftp.texmacs.org/pub/TeXmacs/targz/TeXmacs-0.3.3.15-src.tar.gz">latest stable version</A>,
  cd into the directory where you wish to compile TeXmacs and type
  <pre>
    tar -zxvf TeXmacs-[source version].tar.gz
  </pre>
  All files will be unpacked into the directory
  <tt>TeXmacs-[version]</tt>, which is the 'installation directory'.
</P>

<H3><b>3. Compile, install and run</b></H3>

<P>
  TeXmacs supports the standard GNU compilation and
  installation procedure. Assuming that you logged yourself
  in as root, cd into the installation directory and type
  <pre>
    ./configure
    make
    make install
  </pre>
  The first command examines your particular system configuration.
  The second command launches the compilation.
  Actually, it will first build the generic preprocessors
  'gencc' and 'gendep'. Next the main source will be built.
  The last command installs TeXmacs in <tt>/usr/local</tt>.
</P>

<P>
  If everything works fine, you should be able to run TeXmacs by
  <pre>
    texmacs &
  </pre>
  If this does not work, you should make sure that <tt>/usr/local/bin</tt>
  is in your <tt>PATH</tt>. Depending on your shell,
  you can ensure this by typing
  <pre>
    export PATH=/usr/local/bin:$PATH   or
    setenv PATH /usr/local/bin:$PATH
  </pre>
</P>

<H3><b>4. Configuration options</b></H3>

<P>
  If you cannot log yourself in as root, or if you want to install
  TeXmacs elsewhere than in <tt>/usr/local</tt>,
  then you should use
  <pre>
    ./configure --prefix=[target directory]
  </pre>
  instead of <tt>./configure</tt>. In this case, TeXmacs
  will be installed in <tt>[target directory]</tt> and you
  will have to set your <tt>PATH</tt> accordingly,
  as to contain <tt>[target directory]/bin</tt>.
  Other options supported by <tt>configure</tt> are
  <UL>
    <LI> <tt>--bindir=[binary directory]</tt>:
         sets the directory where the TeXmacs
         binaries should be installed
         (<tt>[target directory]/bin</tt>, by default). </LI>
    <LI> <tt>--datadir=[data directory]</tt>:
         sets the directory where other TeXmacs
         data should be installed.
         (<tt>[target directory]/share</tt>, by default). </LI>
  </UL>
</P>

<H3><b>5. Static compilation</b></H3>

<P>
  By default, we build TeXmacs using dynamically linked libraries.
  If you rather want to build the static version, use
  <pre>
    make STATIC_TEXMACS
  </pre>
  If you have already built a dynamic version of TeXmacs and
  if you want to replace it by a static version,
  you should first clean up some makefiles,
  libraries and binaries, and type
  <pre>
    make OTHER
    make STATIC_TEXMACS
  </pre>

<H3><b>6. Problems</b></H3>

<UL>
  <LI> <I>Your system is not yet supported.</I><BR>
       <b>Solution:</b> add it by modifying the file
       <tt>gencc/src/gg_system.cc</tt>. </LI><BR><BR>

  <LI> <I>You have problems with compiling or linking with X Window.</I><BR>
       <b>Solution:</b> modify some include paths in the file
       <tt>gencc/src/gg_system.cc</tt>. </LI><BR><BR>

  <LI> <I>You have the impression that some of the modifications that you
       made in the source are not taken into account by</I> <tt>gencc</tt>
       <I>and</I> <tt>gendep</tt>.<BR>
       <b>Solution:</b> type <tt>make OTHER</tt> in order to be
       sure that all makefiles are built again and/or
       <tt>rm src/Objects/*</tt> in order to be sure that
       the object files are rebuilt. </LI><BR><BR>

  <LI> <I>You get a segmentation fault when running.</I><BR>
       <b>Solution:</b> check that the macros <tt>WORD_LENGTH</tt>,
       <tt>WORD_LENGTH_INC</tt>
       and <tt>WORD_MASK</tt> in <tt>src/fast_alloc.gen.h</tt>
       are OK for your system. </LI><BR><BR>

  <LI> <I>You have problems with the font system from TeX when running.</I><BR>
       <b>Solution:</b> get a version of TeX with <tt>kpsepath</tt>,
       <tt>MakeTeXPK</tt> and <tt>MakeTeXTFM</tt>. </LI><BR><BR>

  <LI> For other problems, <A href="http://www.texmacs.org/Web/Mail.html">contact us</A>... </LI>
</UL>

<HR>

<BR>

<H3><b>Optimized compilation</b></H3>

<P>
  Using recent versions of the egcs compiler,
  it is possible to considerably speed up TeXmacs
  (with a factor between two and three)
  by optimizing the compilation. I personally use
  the following options on my PC under Gnu-Linux:
  <pre>
    export CXXFLAGS="-O3 -fexpensive-optimizations -malign-loops=2 -malign-jumps=2 -malign-functions=2"
  </pre>
  In order to build TeXmacs using these optimization flags, just type
  <pre>
    make -e
  </pre>
  Notice that you might want to separate the compilation of
  the gencc preprocessor and the actual editor.
  In order to build the preprocessor only, type
  <pre>
    make GENCC
  </pre>
  In a similar fashion, you may compile the editor with debugging information.
  In this case, you have to use the following flags:
  <pre>
    export CXXFLAGS=-g
  </pre>
  Other environment variables recognized during the compilation of
  TeXmacs are
  <UL>
    <LI> <tt>CXX</tt>: the compiler </LI>
    <LI> <tt>CXXFLAGS</tt>: extra compilation flags </LI>
    <LI> <tt>CXXXWINDOW</tt>:
         extra flags for the compilation of Xwindow programs </LI>
    <LI> <tt>CXXGUILE</tt>: flags for finding guile header files </LI>
    <LI> <tt>LD</tt>: the linker (for libraries) </LI>
    <LI> <tt>LDFLAGS</tt>: linker flags </LI>
    <LI> <tt>LDSTATIC</tt>: flags for static linking </LI>
    <LI> <tt>LDSHARED</tt>: flags for shared linking </LI>
    <LI> <tt>LDPATH</tt>: extra linking paths </LI>
    <LI> <tt>LDXWINDOW</tt>: options for Xwindow programs </LI>
    <LI> <tt>LDDL</tt>: options for dynamic linking </LI>
    <LI> <tt>LDGUILE</tt>: options for linking with guile </LI>
    <LI> <tt>LDB</tt>: the linker (for binaries) </LI>
    <LI> <tt>LDBFLAGS</tt>,
         <tt>LDBSTATIC</tt>,
         <tt>LDBSHARED</tt>,
         <tt>LDBPATH</tt>,
         <tt>LDBXWINDOW</tt>,
         <tt>LDBDL</tt>,
         <tt>LDBGUILE</tt>:
         similar options for linking binaries instead of libraries </LI>
    <LI> <tt>AR</tt>: archive program </LI>
    <LI> <tt>ARFLAGS</tt>: flags for archive program </LI>
    <LI> <tt>RM</tt>: remove without messages </LI>
    <LI> <tt>GENCC</tt>: the gencc preprocessor </LI>
  </UL>  

<HR>

<BR>

<H3><b>Problems when compiling with egcs</b></H3>

<P>
  Unfortunately, several bugs seem to persist in the egcs compiler.
  In order to compile TeXmacs using <tt>egcs 2.95.2</tt>,
  optimization and redhat linux, I had to change correct source at
  three places in order to avoid segmentation faults.
</P>

<P>
  A typical example of the kind of changes needed to get things working
  is avoiding nested expressions :
  <pre>
    SI
    TER::get_length (string name) {
      string s= get (name)->label;
      return decode_length (s);
    }
  </pre>
  instead of
  <pre>
    SI
    TER::get_length (string name) {
      return decode_length (get (name)->label);
    }
  </pre>
</P>

<HR>
<BR>

<P>
  Copyright (C) 1999, 2000 by Joris van der Hoeven.
</P>

<P>
  This webpage is part of
  <A HREF="http://www.texmacs.org" TARGET="_top">GNU TeXmacs</A>
  and the larger <A HREF="http://www.gnu.org">GNU project</A>.
  Verbatim copying and distribution of it is permitted in any medium,
  provided this notice is preserved. For more information or questions,
  please contact
  <A HREF="http://www.texmacs.org/Web/Mail.html">Joris van der Hoeven</A>.
</P>

<P>
  <A href="http://www.fsf.org/fsf/fsf.html">Free Software Foundation</A>,
  Inc., 59 Temple Place - Suite 330, Boston, MA 02111, USA
</P>

</BODY>
</HTML>
